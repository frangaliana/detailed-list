(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{129:function(e,t,o){"use strict";var n=o(0),r=o.n(n),s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};var i=function(){return(i=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var l="Pixel",a="Percent",h={unit:a,value:.8};var c=function(e){function t(t){var o=e.call(this,t)||this;return o.lastScrollTop=0,o.actionTriggered=!1,o.startY=0,o.currentY=0,o.dragging=!1,o.maxPullDownDistance=0,o.getScrollableTarget=function(){return o.props.scrollableTarget instanceof HTMLElement?o.props.scrollableTarget:"string"==typeof o.props.scrollableTarget?document.getElementById(o.props.scrollableTarget):(null===o.props.scrollableTarget&&console.warn("You are trying to pass scrollableTarget but it is null. This might\n        happen because the element may not have been added to DOM yet.\n        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.\n      "),null)},o.onStart=function(e){o.lastScrollTop||(o.dragging=!0,e instanceof MouseEvent?o.startY=e.pageY:e instanceof TouchEvent&&(o.startY=e.touches[0].pageY),o.currentY=o.startY,o._infScroll&&(o._infScroll.style.willChange="transform",o._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},o.onMove=function(e){o.dragging&&(e instanceof MouseEvent?o.currentY=e.pageY:e instanceof TouchEvent&&(o.currentY=e.touches[0].pageY),o.currentY<o.startY||(o.currentY-o.startY>=Number(o.props.pullDownToRefreshThreshold)&&o.setState({pullToRefreshThresholdBreached:!0}),o.currentY-o.startY>1.5*o.maxPullDownDistance||o._infScroll&&(o._infScroll.style.overflow="visible",o._infScroll.style.transform="translate3d(0px, "+(o.currentY-o.startY)+"px, 0px)")))},o.onEnd=function(){o.startY=0,o.currentY=0,o.dragging=!1,o.state.pullToRefreshThresholdBreached&&o.props.refreshFunction&&o.props.refreshFunction(),requestAnimationFrame((function(){o._infScroll&&(o._infScroll.style.overflow="auto",o._infScroll.style.transform="none",o._infScroll.style.willChange="none")}))},o.onScrollListener=function(e){"function"==typeof o.props.onScroll&&setTimeout((function(){return o.props.onScroll&&o.props.onScroll(e)}),0);var t=o.props.height||o._scrollableNode?e.target:document.documentElement.scrollTop?document.documentElement:document.body;o.actionTriggered||(o.isElementAtBottom(t,o.props.scrollThreshold)&&o.props.hasMore&&(o.actionTriggered=!0,o.setState({showLoader:!0}),o.props.next&&o.props.next()),o.lastScrollTop=t.scrollTop)},o.state={showLoader:!1,pullToRefreshThresholdBreached:!1},o.throttledOnScrollListener=function(e,t,o,n){var r,s=!1,i=0;function l(){r&&clearTimeout(r)}function a(){var a=this,h=Date.now()-i,c=arguments;function p(){i=Date.now(),o.apply(a,c)}function u(){r=void 0}s||(n&&!r&&p(),l(),void 0===n&&h>e?p():!0!==t&&(r=setTimeout(n?u:p,void 0===n?e-h:e)))}return"boolean"!=typeof t&&(n=o,o=t,t=void 0),a.cancel=function(){l(),s=!0},a}(150,o.onScrollListener).bind(o),o.onStart=o.onStart.bind(o),o.onMove=o.onMove.bind(o),o.onEnd=o.onEnd.bind(o),o}return function(e,t){function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}(t,e),t.prototype.componentDidMount=function(){if(void 0===this.props.dataLength)throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),"number"==typeof this.props.initialScrollY&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),"function"!=typeof this.props.refreshFunction))throw new Error('Mandatory prop "refreshFunction" missing.\n          Pull Down To Refresh functionality will not work\n          as expected. Check README.md for usage\'')},t.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.props.key===e.key&&this.props.dataLength===e.dataLength||(this.actionTriggered=!1,this.setState({showLoader:!1,pullToRefreshThresholdBreached:!1}))},t.prototype.isElementAtBottom=function(e,t){void 0===t&&(t=.8);var o=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,n=function(e){return"number"==typeof e?{unit:a,value:100*e}:"string"==typeof e?e.match(/^(\d*(\.\d+)?)px$/)?{unit:l,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:a,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),h):(console.warn("scrollThreshold should be string or number"),h)}(t);return n.unit===l?e.scrollTop+o>=e.scrollHeight-n.value:e.scrollTop+o>=n.value/100*e.scrollHeight},t.prototype.render=function(){var e=this,t=i({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),o=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),n=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return r.a.createElement("div",{style:n,className:"infinite-scroll-component__outerdiv"},r.a.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(t){return e._infScroll=t},style:t},this.props.pullDownToRefresh&&r.a.createElement("div",{style:{position:"relative"},ref:function(t){return e._pullDown=t}},r.a.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!o&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},t}(n.Component);t.a=c}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcmVhY3QtaW5maW5pdGUtc2Nyb2xsLWNvbXBvbmVudC9kaXN0L2luZGV4LmVzLmpzIl0sIm5hbWVzIjpbImV4dGVuZFN0YXRpY3MiLCJkIiwiYiIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJwIiwiaGFzT3duUHJvcGVydHkiLCJfX2Fzc2lnbiIsImFzc2lnbiIsInQiLCJzIiwiaSIsIm4iLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJwcm90b3R5cGUiLCJjYWxsIiwiYXBwbHkiLCJ0aGlzIiwiVGhyZXNob2xkVW5pdHMiLCJkZWZhdWx0VGhyZXNob2xkIiwidW5pdCIsInZhbHVlIiwiSW5maW5pdGVTY3JvbGwiLCJfc3VwZXIiLCJwcm9wcyIsIl90aGlzIiwibGFzdFNjcm9sbFRvcCIsImFjdGlvblRyaWdnZXJlZCIsInN0YXJ0WSIsImN1cnJlbnRZIiwiZHJhZ2dpbmciLCJtYXhQdWxsRG93bkRpc3RhbmNlIiwiZ2V0U2Nyb2xsYWJsZVRhcmdldCIsInNjcm9sbGFibGVUYXJnZXQiLCJIVE1MRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25zb2xlIiwid2FybiIsIm9uU3RhcnQiLCJldnQiLCJNb3VzZUV2ZW50IiwicGFnZVkiLCJUb3VjaEV2ZW50IiwidG91Y2hlcyIsIl9pbmZTY3JvbGwiLCJzdHlsZSIsIndpbGxDaGFuZ2UiLCJ0cmFuc2l0aW9uIiwib25Nb3ZlIiwiTnVtYmVyIiwicHVsbERvd25Ub1JlZnJlc2hUaHJlc2hvbGQiLCJzZXRTdGF0ZSIsInB1bGxUb1JlZnJlc2hUaHJlc2hvbGRCcmVhY2hlZCIsIm92ZXJmbG93IiwidHJhbnNmb3JtIiwib25FbmQiLCJzdGF0ZSIsInJlZnJlc2hGdW5jdGlvbiIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm9uU2Nyb2xsTGlzdGVuZXIiLCJldmVudCIsIm9uU2Nyb2xsIiwic2V0VGltZW91dCIsInRhcmdldCIsImhlaWdodCIsIl9zY3JvbGxhYmxlTm9kZSIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsImJvZHkiLCJpc0VsZW1lbnRBdEJvdHRvbSIsInNjcm9sbFRocmVzaG9sZCIsImhhc01vcmUiLCJzaG93TG9hZGVyIiwibmV4dCIsInRocm90dGxlZE9uU2Nyb2xsTGlzdGVuZXIiLCJkZWxheSIsIm5vVHJhaWxpbmciLCJjYWxsYmFjayIsImRlYm91bmNlTW9kZSIsInRpbWVvdXRJRCIsImNhbmNlbGxlZCIsImxhc3RFeGVjIiwiY2xlYXJFeGlzdGluZ1RpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJ3cmFwcGVyIiwic2VsZiIsImVsYXBzZWQiLCJEYXRlIiwibm93IiwiYXJncyIsImV4ZWMiLCJjbGVhciIsInVuZGVmaW5lZCIsImNhbmNlbCIsInRocm90dGxlIiwiYmluZCIsIl9fIiwiY29uc3RydWN0b3IiLCJjcmVhdGUiLCJfX2V4dGVuZHMiLCJjb21wb25lbnREaWRNb3VudCIsImRhdGFMZW5ndGgiLCJFcnJvciIsImVsIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImluaXRpYWxTY3JvbGxZIiwic2Nyb2xsSGVpZ2h0Iiwic2Nyb2xsVG8iLCJwdWxsRG93blRvUmVmcmVzaCIsIl9wdWxsRG93biIsImZpcnN0Q2hpbGQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJmb3JjZVVwZGF0ZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwia2V5IiwiY2xpZW50SGVpZ2h0Iiwic2NyZWVuIiwiYXZhaWxIZWlnaHQiLCJ0aHJlc2hvbGQiLCJtYXRjaCIsInBhcnNlRmxvYXQiLCJwYXJzZVRocmVzaG9sZCIsInJlbmRlciIsIldlYmtpdE92ZXJmbG93U2Nyb2xsaW5nIiwiaGFzQ2hpbGRyZW4iLCJjaGlsZHJlbiIsIm91dGVyRGl2U3R5bGUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwicmVmIiwiaW5mU2Nyb2xsIiwicG9zaXRpb24iLCJwdWxsRG93biIsImxlZnQiLCJyaWdodCIsInRvcCIsInJlbGVhc2VUb1JlZnJlc2hDb250ZW50IiwicHVsbERvd25Ub1JlZnJlc2hDb250ZW50IiwibG9hZGVyIiwiZW5kTWVzc2FnZSJdLCJtYXBwaW5ncyI6IjJGQUFBLG9CQWtCSUEsRUFBZ0IsU0FBU0MsRUFBR0MsR0FJNUIsT0FIQUYsRUFBZ0JHLE9BQU9DLGdCQUNsQixDQUFFQyxVQUFXLGNBQWdCQyxPQUFTLFNBQVVMLEVBQUdDLEdBQUtELEVBQUVJLFVBQVlILElBQ3ZFLFNBQVVELEVBQUdDLEdBQUssSUFBSyxJQUFJSyxLQUFLTCxFQUFPQSxFQUFFTSxlQUFlRCxLQUFJTixFQUFFTSxHQUFLTCxFQUFFSyxNQUNwRE4sRUFBR0MsSUFTNUIsSUFBSU8sRUFBVyxXQVFYLE9BUEFBLEVBQVdOLE9BQU9PLFFBQVUsU0FBa0JDLEdBQzFDLElBQUssSUFBSUMsRUFBR0MsRUFBSSxFQUFHQyxFQUFJQyxVQUFVQyxPQUFRSCxFQUFJQyxFQUFHRCxJQUU1QyxJQUFLLElBQUlOLEtBRFRLLEVBQUlHLFVBQVVGLEdBQ09WLE9BQU9jLFVBQVVULGVBQWVVLEtBQUtOLEVBQUdMLEtBQUlJLEVBQUVKLEdBQUtLLEVBQUVMLElBRTlFLE9BQU9JLElBRUtRLE1BQU1DLEtBQU1MLFlBc0hoQyxJQUFJTSxFQUNPLFFBRFBBLEVBRVMsVUFFVEMsRUFBbUIsQ0FDbkJDLEtBQU1GLEVBQ05HLE1BQU8sSUE2QlgsSUFBSUMsRUFBZ0MsU0FBVUMsR0FFMUMsU0FBU0QsRUFBZUUsR0FDcEIsSUFBSUMsRUFBUUYsRUFBT1IsS0FBS0UsS0FBTU8sSUFBVVAsS0FnSHhDLE9BL0dBUSxFQUFNQyxjQUFnQixFQUN0QkQsRUFBTUUsaUJBQWtCLEVBRXhCRixFQUFNRyxPQUFTLEVBQ2ZILEVBQU1JLFNBQVcsRUFDakJKLEVBQU1LLFVBQVcsRUFHakJMLEVBQU1NLG9CQUFzQixFQUM1Qk4sRUFBTU8sb0JBQXNC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TXdHLGdCQUN0Qi9HLEtBQUtPLE1BQU15RyxVQUNWaEgsS0FBS08sTUFBTXlHLG9CQUFvQjlILE9BQy9CYyxLQUFLTyxNQUFNeUcsU0FBU3BILFFBR3hCcUgsRUFBZ0JqSCxLQUFLTyxNQUFNc0YsbUJBQXFCN0YsS0FBS08sTUFBTXlDLE9BQ3pELENBQUVYLFNBQVUsUUFDWixHQUNOLE9BQVEsSUFBTTZFLGNBQWMsTUFBTyxDQUFFckYsTUFBT29GLEVBQWVFLFVBQVcsdUNBQ2xFLElBQU1ELGNBQWMsTUFBTyxDQUFFQyxVQUFXLDhCQUFnQ25ILEtBQUtPLE1BQU00RyxXQUFhLElBQUtDLElBQUssU0FBVUMsR0FBYSxPQUFRN0csRUFBTW9CLFdBQWF5RixHQUFleEYsTUFBT0EsR0FDOUs3QixLQUFLTyxNQUFNc0YsbUJBQXNCLElBQU1xQixjQUFjLE1BQU8sQ0FBRXJGLE1BQU8sQ0FBRXlGLFNBQVUsWUFBY0YsSUFBSyxTQUFVRyxHQUFZLE9BQVEvRyxFQUFNc0YsVUFBWXlCLElBQ2hKLElBQU1MLGNBQWMsTUFBTyxDQUFFckYsTUFBTyxDQUM1QnlGLFNBQVUsV0FDVkUsS0FBTSxFQUNOQyxNQUFPLEVBQ1BDLEtBQU0sRUFBSTFILEtBQUtjLHNCQUNkZCxLQUFLd0MsTUFBTUosK0JBQ2RwQyxLQUFLTyxNQUFNb0gsd0JBQ1gzSCxLQUFLTyxNQUFNcUgsMkJBQ3JCNUgsS0FBS08sTUFBTXlHLFVBQ1ZoSCxLQUFLd0MsTUFBTWdCLGFBQ1B1RCxHQUNEL0csS0FBS08sTUFBTWdELFNBQ1h2RCxLQUFLTyxNQUFNc0gsT0FDZjdILEtBQUt3QyxNQUFNZ0IsWUFBY3hELEtBQUtPLE1BQU1nRCxTQUFXdkQsS0FBS08sTUFBTXNILFFBQ3pEN0gsS0FBS08sTUFBTWdELFNBQVd2RCxLQUFLTyxNQUFNdUgsY0FFdkN6SCxFQWpPd0IsQ0FrT2pDLGFBRWEiLCJmaWxlIjoibnBtLnJlYWN0LWluZmluaXRlLXNjcm9sbC1jb21wb25lbnQuY2FhZTk5ZDZlZGQ3MDE1ZWI1YmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuXG4vKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxyXG50aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxyXG5MaWNlbnNlIGF0IGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxyXG5LSU5ELCBFSVRIRVIgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgV0lUSE9VVCBMSU1JVEFUSU9OIEFOWSBJTVBMSUVEXHJcbldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsXHJcbk1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuXHJcblxyXG5TZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcclxuYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG52YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59O1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZmluZWQsbm8tcGFyYW0tcmVhc3NpZ24sbm8tc2hhZG93ICovXG5cbi8qKlxuICogVGhyb3R0bGUgZXhlY3V0aW9uIG9mIGEgZnVuY3Rpb24uIEVzcGVjaWFsbHkgdXNlZnVsIGZvciByYXRlIGxpbWl0aW5nXG4gKiBleGVjdXRpb24gb2YgaGFuZGxlcnMgb24gZXZlbnRzIGxpa2UgcmVzaXplIGFuZCBzY3JvbGwuXG4gKlxuICogQHBhcmFtICB7TnVtYmVyfSAgICBkZWxheSAgICAgICAgICBBIHplcm8tb3ItZ3JlYXRlciBkZWxheSBpbiBtaWxsaXNlY29uZHMuIEZvciBldmVudCBjYWxsYmFja3MsIHZhbHVlcyBhcm91bmQgMTAwIG9yIDI1MCAob3IgZXZlbiBoaWdoZXIpIGFyZSBtb3N0IHVzZWZ1bC5cbiAqIEBwYXJhbSAge0Jvb2xlYW59ICAgW25vVHJhaWxpbmddICAgT3B0aW9uYWwsIGRlZmF1bHRzIHRvIGZhbHNlLiBJZiBub1RyYWlsaW5nIGlzIHRydWUsIGNhbGxiYWNrIHdpbGwgb25seSBleGVjdXRlIGV2ZXJ5IGBkZWxheWAgbWlsbGlzZWNvbmRzIHdoaWxlIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdHRsZWQtZnVuY3Rpb24gaXMgYmVpbmcgY2FsbGVkLiBJZiBub1RyYWlsaW5nIGlzIGZhbHNlIG9yIHVuc3BlY2lmaWVkLCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIG9uZSBmaW5hbCB0aW1lXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyIHRoZSBsYXN0IHRocm90dGxlZC1mdW5jdGlvbiBjYWxsLiAoQWZ0ZXIgdGhlIHRocm90dGxlZC1mdW5jdGlvbiBoYXMgbm90IGJlZW4gY2FsbGVkIGZvciBgZGVsYXlgIG1pbGxpc2Vjb25kcyxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGludGVybmFsIGNvdW50ZXIgaXMgcmVzZXQpXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgIEEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgYWZ0ZXIgZGVsYXkgbWlsbGlzZWNvbmRzLiBUaGUgYHRoaXNgIGNvbnRleHQgYW5kIGFsbCBhcmd1bWVudHMgYXJlIHBhc3NlZCB0aHJvdWdoLCBhcy1pcyxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gYGNhbGxiYWNrYCB3aGVuIHRoZSB0aHJvdHRsZWQtZnVuY3Rpb24gaXMgZXhlY3V0ZWQuXG4gKiBAcGFyYW0gIHtCb29sZWFufSAgIFtkZWJvdW5jZU1vZGVdIElmIGBkZWJvdW5jZU1vZGVgIGlzIHRydWUgKGF0IGJlZ2luKSwgc2NoZWR1bGUgYGNsZWFyYCB0byBleGVjdXRlIGFmdGVyIGBkZWxheWAgbXMuIElmIGBkZWJvdW5jZU1vZGVgIGlzIGZhbHNlIChhdCBlbmQpLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZSBgY2FsbGJhY2tgIHRvIGV4ZWN1dGUgYWZ0ZXIgYGRlbGF5YCBtcy5cbiAqXG4gKiBAcmV0dXJuIHtGdW5jdGlvbn0gIEEgbmV3LCB0aHJvdHRsZWQsIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiB0aHJvdHRsZSAoZGVsYXksIG5vVHJhaWxpbmcsIGNhbGxiYWNrLCBkZWJvdW5jZU1vZGUpIHtcbiAgLypcbiAgICogQWZ0ZXIgd3JhcHBlciBoYXMgc3RvcHBlZCBiZWluZyBjYWxsZWQsIHRoaXMgdGltZW91dCBlbnN1cmVzIHRoYXRcbiAgICogYGNhbGxiYWNrYCBpcyBleGVjdXRlZCBhdCB0aGUgcHJvcGVyIHRpbWVzIGluIGB0aHJvdHRsZWAgYW5kIGBlbmRgXG4gICAqIGRlYm91bmNlIG1vZGVzLlxuICAgKi9cbiAgdmFyIHRpbWVvdXRJRDtcbiAgdmFyIGNhbmNlbGxlZCA9IGZhbHNlOyAvLyBLZWVwIHRyYWNrIG9mIHRoZSBsYXN0IHRpbWUgYGNhbGxiYWNrYCB3YXMgZXhlY3V0ZWQuXG5cbiAgdmFyIGxhc3RFeGVjID0gMDsgLy8gRnVuY3Rpb24gdG8gY2xlYXIgZXhpc3RpbmcgdGltZW91dFxuXG4gIGZ1bmN0aW9uIGNsZWFyRXhpc3RpbmdUaW1lb3V0KCkge1xuICAgIGlmICh0aW1lb3V0SUQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SUQpO1xuICAgIH1cbiAgfSAvLyBGdW5jdGlvbiB0byBjYW5jZWwgbmV4dCBleGVjXG5cblxuICBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgY2xlYXJFeGlzdGluZ1RpbWVvdXQoKTtcbiAgICBjYW5jZWxsZWQgPSB0cnVlO1xuICB9IC8vIGBub1RyYWlsaW5nYCBkZWZhdWx0cyB0byBmYWxzeS5cblxuXG4gIGlmICh0eXBlb2Ygbm9UcmFpbGluZyAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgZGVib3VuY2VNb2RlID0gY2FsbGJhY2s7XG4gICAgY2FsbGJhY2sgPSBub1RyYWlsaW5nO1xuICAgIG5vVHJhaWxpbmcgPSB1bmRlZmluZWQ7XG4gIH1cbiAgLypcbiAgICogVGhlIGB3cmFwcGVyYCBmdW5jdGlvbiBlbmNhcHN1bGF0ZXMgYWxsIG9mIHRoZSB0aHJvdHRsaW5nIC8gZGVib3VuY2luZ1xuICAgKiBmdW5jdGlvbmFsaXR5IGFuZCB3aGVuIGV4ZWN1dGVkIHdpbGwgbGltaXQgdGhlIHJhdGUgYXQgd2hpY2ggYGNhbGxiYWNrYFxuICAgKiBpcyBleGVjdXRlZC5cbiAgICovXG5cblxuICBmdW5jdGlvbiB3cmFwcGVyKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgZWxhcHNlZCA9IERhdGUubm93KCkgLSBsYXN0RXhlYztcbiAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcblxuICAgIGlmIChjYW5jZWxsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9IC8vIEV4ZWN1dGUgYGNhbGxiYWNrYCBhbmQgdXBkYXRlIHRoZSBgbGFzdEV4ZWNgIHRpbWVzdGFtcC5cblxuXG4gICAgZnVuY3Rpb24gZXhlYygpIHtcbiAgICAgIGxhc3RFeGVjID0gRGF0ZS5ub3coKTtcbiAgICAgIGNhbGxiYWNrLmFwcGx5KHNlbGYsIGFyZ3MpO1xuICAgIH1cbiAgICAvKlxuICAgICAqIElmIGBkZWJvdW5jZU1vZGVgIGlzIHRydWUgKGF0IGJlZ2luKSB0aGlzIGlzIHVzZWQgdG8gY2xlYXIgdGhlIGZsYWdcbiAgICAgKiB0byBhbGxvdyBmdXR1cmUgYGNhbGxiYWNrYCBleGVjdXRpb25zLlxuICAgICAqL1xuXG5cbiAgICBmdW5jdGlvbiBjbGVhcigpIHtcbiAgICAgIHRpbWVvdXRJRCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAoZGVib3VuY2VNb2RlICYmICF0aW1lb3V0SUQpIHtcbiAgICAgIC8qXG4gICAgICAgKiBTaW5jZSBgd3JhcHBlcmAgaXMgYmVpbmcgY2FsbGVkIGZvciB0aGUgZmlyc3QgdGltZSBhbmRcbiAgICAgICAqIGBkZWJvdW5jZU1vZGVgIGlzIHRydWUgKGF0IGJlZ2luKSwgZXhlY3V0ZSBgY2FsbGJhY2tgLlxuICAgICAgICovXG4gICAgICBleGVjKCk7XG4gICAgfVxuXG4gICAgY2xlYXJFeGlzdGluZ1RpbWVvdXQoKTtcblxuICAgIGlmIChkZWJvdW5jZU1vZGUgPT09IHVuZGVmaW5lZCAmJiBlbGFwc2VkID4gZGVsYXkpIHtcbiAgICAgIC8qXG4gICAgICAgKiBJbiB0aHJvdHRsZSBtb2RlLCBpZiBgZGVsYXlgIHRpbWUgaGFzIGJlZW4gZXhjZWVkZWQsIGV4ZWN1dGVcbiAgICAgICAqIGBjYWxsYmFja2AuXG4gICAgICAgKi9cbiAgICAgIGV4ZWMoKTtcbiAgICB9IGVsc2UgaWYgKG5vVHJhaWxpbmcgIT09IHRydWUpIHtcbiAgICAgIC8qXG4gICAgICAgKiBJbiB0cmFpbGluZyB0aHJvdHRsZSBtb2RlLCBzaW5jZSBgZGVsYXlgIHRpbWUgaGFzIG5vdCBiZWVuXG4gICAgICAgKiBleGNlZWRlZCwgc2NoZWR1bGUgYGNhbGxiYWNrYCB0byBleGVjdXRlIGBkZWxheWAgbXMgYWZ0ZXIgbW9zdFxuICAgICAgICogcmVjZW50IGV4ZWN1dGlvbi5cbiAgICAgICAqXG4gICAgICAgKiBJZiBgZGVib3VuY2VNb2RlYCBpcyB0cnVlIChhdCBiZWdpbiksIHNjaGVkdWxlIGBjbGVhcmAgdG8gZXhlY3V0ZVxuICAgICAgICogYWZ0ZXIgYGRlbGF5YCBtcy5cbiAgICAgICAqXG4gICAgICAgKiBJZiBgZGVib3VuY2VNb2RlYCBpcyBmYWxzZSAoYXQgZW5kKSwgc2NoZWR1bGUgYGNhbGxiYWNrYCB0b1xuICAgICAgICogZXhlY3V0ZSBhZnRlciBgZGVsYXlgIG1zLlxuICAgICAgICovXG4gICAgICB0aW1lb3V0SUQgPSBzZXRUaW1lb3V0KGRlYm91bmNlTW9kZSA/IGNsZWFyIDogZXhlYywgZGVib3VuY2VNb2RlID09PSB1bmRlZmluZWQgPyBkZWxheSAtIGVsYXBzZWQgOiBkZWxheSk7XG4gICAgfVxuICB9XG5cbiAgd3JhcHBlci5jYW5jZWwgPSBjYW5jZWw7IC8vIFJldHVybiB0aGUgd3JhcHBlciBmdW5jdGlvbi5cblxuICByZXR1cm4gd3JhcHBlcjtcbn1cblxudmFyIFRocmVzaG9sZFVuaXRzID0ge1xyXG4gICAgUGl4ZWw6ICdQaXhlbCcsXHJcbiAgICBQZXJjZW50OiAnUGVyY2VudCcsXHJcbn07XHJcbnZhciBkZWZhdWx0VGhyZXNob2xkID0ge1xyXG4gICAgdW5pdDogVGhyZXNob2xkVW5pdHMuUGVyY2VudCxcclxuICAgIHZhbHVlOiAwLjgsXHJcbn07XHJcbmZ1bmN0aW9uIHBhcnNlVGhyZXNob2xkKHNjcm9sbFRocmVzaG9sZCkge1xyXG4gICAgaWYgKHR5cGVvZiBzY3JvbGxUaHJlc2hvbGQgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdW5pdDogVGhyZXNob2xkVW5pdHMuUGVyY2VudCxcclxuICAgICAgICAgICAgdmFsdWU6IHNjcm9sbFRocmVzaG9sZCAqIDEwMCxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBzY3JvbGxUaHJlc2hvbGQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgaWYgKHNjcm9sbFRocmVzaG9sZC5tYXRjaCgvXihcXGQqKFxcLlxcZCspPylweCQvKSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgdW5pdDogVGhyZXNob2xkVW5pdHMuUGl4ZWwsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogcGFyc2VGbG9hdChzY3JvbGxUaHJlc2hvbGQpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2Nyb2xsVGhyZXNob2xkLm1hdGNoKC9eKFxcZCooXFwuXFxkKyk/KSUkLykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHVuaXQ6IFRocmVzaG9sZFVuaXRzLlBlcmNlbnQsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogcGFyc2VGbG9hdChzY3JvbGxUaHJlc2hvbGQpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLndhcm4oJ3Njcm9sbFRocmVzaG9sZCBmb3JtYXQgaXMgaW52YWxpZC4gVmFsaWQgZm9ybWF0czogXCIxMjBweFwiLCBcIjUwJVwiLi4uJyk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRUaHJlc2hvbGQ7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLndhcm4oJ3Njcm9sbFRocmVzaG9sZCBzaG91bGQgYmUgc3RyaW5nIG9yIG51bWJlcicpO1xyXG4gICAgcmV0dXJuIGRlZmF1bHRUaHJlc2hvbGQ7XHJcbn1cblxudmFyIEluZmluaXRlU2Nyb2xsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEluZmluaXRlU2Nyb2xsLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gSW5maW5pdGVTY3JvbGwocHJvcHMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5sYXN0U2Nyb2xsVG9wID0gMDtcclxuICAgICAgICBfdGhpcy5hY3Rpb25UcmlnZ2VyZWQgPSBmYWxzZTtcclxuICAgICAgICAvLyB2YXJpYWJsZXMgdG8ga2VlcCB0cmFjayBvZiBwdWxsIGRvd24gYmVoYXZpb3VyXHJcbiAgICAgICAgX3RoaXMuc3RhcnRZID0gMDtcclxuICAgICAgICBfdGhpcy5jdXJyZW50WSA9IDA7XHJcbiAgICAgICAgX3RoaXMuZHJhZ2dpbmcgPSBmYWxzZTtcclxuICAgICAgICAvLyB3aWxsIGJlIHBvcHVsYXRlZCBpbiBjb21wb25lbnREaWRNb3VudFxyXG4gICAgICAgIC8vIGJhc2VkIG9uIHRoZSBoZWlnaHQgb2YgdGhlIHB1bGwgZG93biBlbGVtZW50XHJcbiAgICAgICAgX3RoaXMubWF4UHVsbERvd25EaXN0YW5jZSA9IDA7XHJcbiAgICAgICAgX3RoaXMuZ2V0U2Nyb2xsYWJsZVRhcmdldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKF90aGlzLnByb3BzLnNjcm9sbGFibGVUYXJnZXQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudClcclxuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5wcm9wcy5zY3JvbGxhYmxlVGFyZ2V0O1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIF90aGlzLnByb3BzLnNjcm9sbGFibGVUYXJnZXQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoX3RoaXMucHJvcHMuc2Nyb2xsYWJsZVRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF90aGlzLnByb3BzLnNjcm9sbGFibGVUYXJnZXQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIllvdSBhcmUgdHJ5aW5nIHRvIHBhc3Mgc2Nyb2xsYWJsZVRhcmdldCBidXQgaXQgaXMgbnVsbC4gVGhpcyBtaWdodFxcbiAgICAgICAgaGFwcGVuIGJlY2F1c2UgdGhlIGVsZW1lbnQgbWF5IG5vdCBoYXZlIGJlZW4gYWRkZWQgdG8gRE9NIHlldC5cXG4gICAgICAgIFNlZSBodHRwczovL2dpdGh1Yi5jb20vYW5rZWV0bWFpbmkvcmVhY3QtaW5maW5pdGUtc2Nyb2xsLWNvbXBvbmVudC9pc3N1ZXMvNTkgZm9yIG1vcmUgaW5mby5cXG4gICAgICBcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5vblN0YXJ0ID0gZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMubGFzdFNjcm9sbFRvcClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgX3RoaXMuZHJhZ2dpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoZXZ0IGluc3RhbmNlb2YgTW91c2VFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuc3RhcnRZID0gZXZ0LnBhZ2VZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGV2dCBpbnN0YW5jZW9mIFRvdWNoRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLnN0YXJ0WSA9IGV2dC50b3VjaGVzWzBdLnBhZ2VZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF90aGlzLmN1cnJlbnRZID0gX3RoaXMuc3RhcnRZO1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuX2luZlNjcm9sbCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX2luZlNjcm9sbC5zdHlsZS53aWxsQ2hhbmdlID0gJ3RyYW5zZm9ybSc7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5faW5mU2Nyb2xsLnN0eWxlLnRyYW5zaXRpb24gPSBcInRyYW5zZm9ybSAwLjJzIGN1YmljLWJlemllcigwLDAsMC4zMSwxKVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5vbk1vdmUgPSBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgICAgIGlmICghX3RoaXMuZHJhZ2dpbmcpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGlmIChldnQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jdXJyZW50WSA9IGV2dC5wYWdlWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChldnQgaW5zdGFuY2VvZiBUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jdXJyZW50WSA9IGV2dC50b3VjaGVzWzBdLnBhZ2VZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHVzZXIgaXMgc2Nyb2xsaW5nIGRvd24gdG8gdXBcclxuICAgICAgICAgICAgaWYgKF90aGlzLmN1cnJlbnRZIDwgX3RoaXMuc3RhcnRZKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuY3VycmVudFkgLSBfdGhpcy5zdGFydFkgPj1cclxuICAgICAgICAgICAgICAgIE51bWJlcihfdGhpcy5wcm9wcy5wdWxsRG93blRvUmVmcmVzaFRocmVzaG9sZCkpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgICAgICBwdWxsVG9SZWZyZXNoVGhyZXNob2xkQnJlYWNoZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBzbyB5b3UgY2FuIGRyYWcgdXB0byAxLjUgdGltZXMgb2YgdGhlIG1heFB1bGxEb3duRGlzdGFuY2VcclxuICAgICAgICAgICAgaWYgKF90aGlzLmN1cnJlbnRZIC0gX3RoaXMuc3RhcnRZID4gX3RoaXMubWF4UHVsbERvd25EaXN0YW5jZSAqIDEuNSlcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgaWYgKF90aGlzLl9pbmZTY3JvbGwpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLl9pbmZTY3JvbGwuc3R5bGUub3ZlcmZsb3cgPSAndmlzaWJsZSc7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5faW5mU2Nyb2xsLnN0eWxlLnRyYW5zZm9ybSA9IFwidHJhbnNsYXRlM2QoMHB4LCBcIiArIChfdGhpcy5jdXJyZW50WSAtXHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RhcnRZKSArIFwicHgsIDBweClcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMub25FbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnN0YXJ0WSA9IDA7XHJcbiAgICAgICAgICAgIF90aGlzLmN1cnJlbnRZID0gMDtcclxuICAgICAgICAgICAgX3RoaXMuZHJhZ2dpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLnB1bGxUb1JlZnJlc2hUaHJlc2hvbGRCcmVhY2hlZCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucHJvcHMucmVmcmVzaEZ1bmN0aW9uICYmIF90aGlzLnByb3BzLnJlZnJlc2hGdW5jdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLl9pbmZTY3JvbGxcclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5faW5mU2Nyb2xsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2luZlNjcm9sbC5zdHlsZS5vdmVyZmxvdyA9ICdhdXRvJztcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5faW5mU2Nyb2xsLnN0eWxlLnRyYW5zZm9ybSA9ICdub25lJztcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5faW5mU2Nyb2xsLnN0eWxlLndpbGxDaGFuZ2UgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMub25TY3JvbGxMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIF90aGlzLnByb3BzLm9uU2Nyb2xsID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoaXMgY2FsbGJhY2sgaW4gbmV4dCB0aWNrIHNvIHRoYXQgaXQgZG9lcyBub3QgYWZmZWN0IHRoZVxyXG4gICAgICAgICAgICAgICAgLy8gZnVuY3Rpb25hbGl0eSBvZiB0aGUgbGlicmFyeS5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMucHJvcHMub25TY3JvbGwgJiYgX3RoaXMucHJvcHMub25TY3JvbGwoZXZlbnQpOyB9LCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gX3RoaXMucHJvcHMuaGVpZ2h0IHx8IF90aGlzLl9zY3JvbGxhYmxlTm9kZVxyXG4gICAgICAgICAgICAgICAgPyBldmVudC50YXJnZXRcclxuICAgICAgICAgICAgICAgIDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcFxyXG4gICAgICAgICAgICAgICAgICAgID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgOiBkb2N1bWVudC5ib2R5O1xyXG4gICAgICAgICAgICAvLyByZXR1cm4gaW1tZWRpYXRlbHkgaWYgdGhlIGFjdGlvbiBoYXMgYWxyZWFkeSBiZWVuIHRyaWdnZXJlZCxcclxuICAgICAgICAgICAgLy8gcHJldmVudHMgbXVsdGlwbGUgdHJpZ2dlcnMuXHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5hY3Rpb25UcmlnZ2VyZWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIHZhciBhdEJvdHRvbSA9IF90aGlzLmlzRWxlbWVudEF0Qm90dG9tKHRhcmdldCwgX3RoaXMucHJvcHMuc2Nyb2xsVGhyZXNob2xkKTtcclxuICAgICAgICAgICAgLy8gY2FsbCB0aGUgYG5leHRgIGZ1bmN0aW9uIGluIHRoZSBwcm9wcyB0byB0cmlnZ2VyIHRoZSBuZXh0IGRhdGEgZmV0Y2hcclxuICAgICAgICAgICAgaWYgKGF0Qm90dG9tICYmIF90aGlzLnByb3BzLmhhc01vcmUpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmFjdGlvblRyaWdnZXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNob3dMb2FkZXI6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5uZXh0ICYmIF90aGlzLnByb3BzLm5leHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfdGhpcy5sYXN0U2Nyb2xsVG9wID0gdGFyZ2V0LnNjcm9sbFRvcDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0ge1xyXG4gICAgICAgICAgICBzaG93TG9hZGVyOiBmYWxzZSxcclxuICAgICAgICAgICAgcHVsbFRvUmVmcmVzaFRocmVzaG9sZEJyZWFjaGVkOiBmYWxzZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnRocm90dGxlZE9uU2Nyb2xsTGlzdGVuZXIgPSB0aHJvdHRsZSgxNTAsIF90aGlzLm9uU2Nyb2xsTGlzdGVuZXIpLmJpbmQoX3RoaXMpO1xyXG4gICAgICAgIF90aGlzLm9uU3RhcnQgPSBfdGhpcy5vblN0YXJ0LmJpbmQoX3RoaXMpO1xyXG4gICAgICAgIF90aGlzLm9uTW92ZSA9IF90aGlzLm9uTW92ZS5iaW5kKF90aGlzKTtcclxuICAgICAgICBfdGhpcy5vbkVuZCA9IF90aGlzLm9uRW5kLmJpbmQoX3RoaXMpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEluZmluaXRlU2Nyb2xsLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMucHJvcHMuZGF0YUxlbmd0aCA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibWFuZGF0b3J5IHByb3AgXFxcImRhdGFMZW5ndGhcXFwiIGlzIG1pc3NpbmcuIFRoZSBwcm9wIGlzIG5lZWRlZFwiICtcclxuICAgICAgICAgICAgICAgIFwiIHdoZW4gbG9hZGluZyBtb3JlIGNvbnRlbnQuIENoZWNrIFJFQURNRS5tZCBmb3IgdXNhZ2VcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3Njcm9sbGFibGVOb2RlID0gdGhpcy5nZXRTY3JvbGxhYmxlVGFyZ2V0KCk7XHJcbiAgICAgICAgdGhpcy5lbCA9IHRoaXMucHJvcHMuaGVpZ2h0XHJcbiAgICAgICAgICAgID8gdGhpcy5faW5mU2Nyb2xsXHJcbiAgICAgICAgICAgIDogdGhpcy5fc2Nyb2xsYWJsZU5vZGUgfHwgd2luZG93O1xyXG4gICAgICAgIGlmICh0aGlzLmVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpc1xyXG4gICAgICAgICAgICAgICAgLnRocm90dGxlZE9uU2Nyb2xsTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMucHJvcHMuaW5pdGlhbFNjcm9sbFkgPT09ICdudW1iZXInICYmXHJcbiAgICAgICAgICAgIHRoaXMuZWwgJiZcclxuICAgICAgICAgICAgdGhpcy5lbCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmXHJcbiAgICAgICAgICAgIHRoaXMuZWwuc2Nyb2xsSGVpZ2h0ID4gdGhpcy5wcm9wcy5pbml0aWFsU2Nyb2xsWSkge1xyXG4gICAgICAgICAgICB0aGlzLmVsLnNjcm9sbFRvKDAsIHRoaXMucHJvcHMuaW5pdGlhbFNjcm9sbFkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5wcm9wcy5wdWxsRG93blRvUmVmcmVzaCAmJiB0aGlzLmVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25TdGFydCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5vbk1vdmUpO1xyXG4gICAgICAgICAgICB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vbkVuZCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5vblN0YXJ0KTtcclxuICAgICAgICAgICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW92ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25FbmQpO1xyXG4gICAgICAgICAgICAvLyBnZXQgQkNSIG9mIHB1bGxEb3duIGVsZW1lbnQgdG8gcG9zaXRpb24gaXQgYWJvdmVcclxuICAgICAgICAgICAgdGhpcy5tYXhQdWxsRG93bkRpc3RhbmNlID1cclxuICAgICAgICAgICAgICAgICh0aGlzLl9wdWxsRG93biAmJlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3B1bGxEb3duLmZpcnN0Q2hpbGQgJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wdWxsRG93bi5maXJzdENoaWxkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5oZWlnaHQpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgMDtcclxuICAgICAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMucHJvcHMucmVmcmVzaEZ1bmN0aW9uICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNYW5kYXRvcnkgcHJvcCBcXFwicmVmcmVzaEZ1bmN0aW9uXFxcIiBtaXNzaW5nLlxcbiAgICAgICAgICBQdWxsIERvd24gVG8gUmVmcmVzaCBmdW5jdGlvbmFsaXR5IHdpbGwgbm90IHdvcmtcXG4gICAgICAgICAgYXMgZXhwZWN0ZWQuIENoZWNrIFJFQURNRS5tZCBmb3IgdXNhZ2UnXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEluZmluaXRlU2Nyb2xsLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5lbCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXNcclxuICAgICAgICAgICAgICAgIC50aHJvdHRsZWRPblNjcm9sbExpc3RlbmVyKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMucHVsbERvd25Ub1JlZnJlc2gpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25TdGFydCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMub25Nb3ZlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uRW5kKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5vblN0YXJ0KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5vbk1vdmUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5vbkVuZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSW5maW5pdGVTY3JvbGwucHJvdG90eXBlLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzID0gZnVuY3Rpb24gKHByb3BzKSB7XHJcbiAgICAgICAgLy8gZG8gbm90aGluZyB3aGVuIGRhdGFMZW5ndGggYW5kIGtleSBhcmUgdW5jaGFuZ2VkXHJcbiAgICAgICAgaWYgKHRoaXMucHJvcHMua2V5ID09PSBwcm9wcy5rZXkgJiZcclxuICAgICAgICAgICAgdGhpcy5wcm9wcy5kYXRhTGVuZ3RoID09PSBwcm9wcy5kYXRhTGVuZ3RoKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdGhpcy5hY3Rpb25UcmlnZ2VyZWQgPSBmYWxzZTtcclxuICAgICAgICAvLyB1cGRhdGUgc3RhdGUgd2hlbiBuZXcgZGF0YSB3YXMgc2VudCBpblxyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICBzaG93TG9hZGVyOiBmYWxzZSxcclxuICAgICAgICAgICAgcHVsbFRvUmVmcmVzaFRocmVzaG9sZEJyZWFjaGVkOiBmYWxzZSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBJbmZpbml0ZVNjcm9sbC5wcm90b3R5cGUuaXNFbGVtZW50QXRCb3R0b20gPSBmdW5jdGlvbiAodGFyZ2V0LCBzY3JvbGxUaHJlc2hvbGQpIHtcclxuICAgICAgICBpZiAoc2Nyb2xsVGhyZXNob2xkID09PSB2b2lkIDApIHsgc2Nyb2xsVGhyZXNob2xkID0gMC44OyB9XHJcbiAgICAgICAgdmFyIGNsaWVudEhlaWdodCA9IHRhcmdldCA9PT0gZG9jdW1lbnQuYm9keSB8fCB0YXJnZXQgPT09IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxyXG4gICAgICAgICAgICA/IHdpbmRvdy5zY3JlZW4uYXZhaWxIZWlnaHRcclxuICAgICAgICAgICAgOiB0YXJnZXQuY2xpZW50SGVpZ2h0O1xyXG4gICAgICAgIHZhciB0aHJlc2hvbGQgPSBwYXJzZVRocmVzaG9sZChzY3JvbGxUaHJlc2hvbGQpO1xyXG4gICAgICAgIGlmICh0aHJlc2hvbGQudW5pdCA9PT0gVGhyZXNob2xkVW5pdHMuUGl4ZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuICh0YXJnZXQuc2Nyb2xsVG9wICsgY2xpZW50SGVpZ2h0ID49IHRhcmdldC5zY3JvbGxIZWlnaHQgLSB0aHJlc2hvbGQudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gKHRhcmdldC5zY3JvbGxUb3AgKyBjbGllbnRIZWlnaHQgPj1cclxuICAgICAgICAgICAgKHRocmVzaG9sZC52YWx1ZSAvIDEwMCkgKiB0YXJnZXQuc2Nyb2xsSGVpZ2h0KTtcclxuICAgIH07XHJcbiAgICBJbmZpbml0ZVNjcm9sbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHN0eWxlID0gX19hc3NpZ24oeyBoZWlnaHQ6IHRoaXMucHJvcHMuaGVpZ2h0IHx8ICdhdXRvJywgb3ZlcmZsb3c6ICdhdXRvJywgV2Via2l0T3ZlcmZsb3dTY3JvbGxpbmc6ICd0b3VjaCcgfSwgdGhpcy5wcm9wcy5zdHlsZSk7XHJcbiAgICAgICAgdmFyIGhhc0NoaWxkcmVuID0gdGhpcy5wcm9wcy5oYXNDaGlsZHJlbiB8fFxyXG4gICAgICAgICAgICAhISh0aGlzLnByb3BzLmNoaWxkcmVuICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmNoaWxkcmVuIGluc3RhbmNlb2YgQXJyYXkgJiZcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuY2hpbGRyZW4ubGVuZ3RoKTtcclxuICAgICAgICAvLyBiZWNhdXNlIGhlaWdodGVkIGluZmluaXRlU2Nyb2xsIHZpc3VhbHkgYnJlYWtzXHJcbiAgICAgICAgLy8gb24gZHJhZyBkb3duIGFzIG92ZXJmbG93IGJlY29tZXMgdmlzaWJsZVxyXG4gICAgICAgIHZhciBvdXRlckRpdlN0eWxlID0gdGhpcy5wcm9wcy5wdWxsRG93blRvUmVmcmVzaCAmJiB0aGlzLnByb3BzLmhlaWdodFxyXG4gICAgICAgICAgICA/IHsgb3ZlcmZsb3c6ICdhdXRvJyB9XHJcbiAgICAgICAgICAgIDoge307XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgc3R5bGU6IG91dGVyRGl2U3R5bGUsIGNsYXNzTmFtZTogXCJpbmZpbml0ZS1zY3JvbGwtY29tcG9uZW50X19vdXRlcmRpdlwiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiaW5maW5pdGUtc2Nyb2xsLWNvbXBvbmVudCBcIiArICh0aGlzLnByb3BzLmNsYXNzTmFtZSB8fCAnJyksIHJlZjogZnVuY3Rpb24gKGluZlNjcm9sbCkgeyByZXR1cm4gKF90aGlzLl9pbmZTY3JvbGwgPSBpbmZTY3JvbGwpOyB9LCBzdHlsZTogc3R5bGUgfSxcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMucHVsbERvd25Ub1JlZnJlc2ggJiYgKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBzdHlsZTogeyBwb3NpdGlvbjogJ3JlbGF0aXZlJyB9LCByZWY6IGZ1bmN0aW9uIChwdWxsRG93bikgeyByZXR1cm4gKF90aGlzLl9wdWxsRG93biA9IHB1bGxEb3duKTsgfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBzdHlsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IC0xICogdGhpcy5tYXhQdWxsRG93bkRpc3RhbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IH0sIHRoaXMuc3RhdGUucHVsbFRvUmVmcmVzaFRocmVzaG9sZEJyZWFjaGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5wcm9wcy5yZWxlYXNlVG9SZWZyZXNoQ29udGVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHRoaXMucHJvcHMucHVsbERvd25Ub1JlZnJlc2hDb250ZW50KSkpLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5jaGlsZHJlbixcclxuICAgICAgICAgICAgICAgICF0aGlzLnN0YXRlLnNob3dMb2FkZXIgJiZcclxuICAgICAgICAgICAgICAgICAgICAhaGFzQ2hpbGRyZW4gJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmhhc01vcmUgJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmxvYWRlcixcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuc2hvd0xvYWRlciAmJiB0aGlzLnByb3BzLmhhc01vcmUgJiYgdGhpcy5wcm9wcy5sb2FkZXIsXHJcbiAgICAgICAgICAgICAgICAhdGhpcy5wcm9wcy5oYXNNb3JlICYmIHRoaXMucHJvcHMuZW5kTWVzc2FnZSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSW5maW5pdGVTY3JvbGw7XHJcbn0oQ29tcG9uZW50KSk7XG5cbmV4cG9ydCBkZWZhdWx0IEluZmluaXRlU2Nyb2xsO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXMuanMubWFwXG4iXSwic291cmNlUm9vdCI6IiJ9